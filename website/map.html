<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<link href="./css/map_styles.css" rel="stylesheet" type="text/css" media="screen" />
		<script src="./lib/jquery-1.8.3.min.js"></script>
		<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCi3bjBYQwpwC0v2cjxR4Me5AKu4l_p-98&sensor=false"></script>
		<script type="text/javascript" src="./lib/markerwithlabel.js"></script>
		<script type="text/javascript" src="./lib/mapfunctions.js"></script>
		<script type="text/javascript" src="./lib/jquery.contextmenu.r2.js"></script>
		<script type="text/javascript">
			var map;
			var actualCrosshairPosition;
			var standardMarkerArray = new Array();
			var routeMarkerArray = new Array();
			var route;
			var actualCrosshairMarker = null;
			var selectedMarker;
			function initialize() {
				var mapTypeIds = ["roadmap", "satellite", "OSM"];
				var mapOptions = {
					center : new google.maps.LatLng(47.66, 9.16),
					zoom : 14,
					mapTypeId : google.maps.MapTypeId.ROADMAP,
					mapTypeControlOptions : {
						mapTypeIds : mapTypeIds
					}
				};
				map = new google.maps.Map(document.getElementById("mapCanvas"), mapOptions);

				// -------- Open Sea Map --------
				addSeamap();

				// -------- Center Coordinates shown on the Left Top Overlay --------
				var myControl = document.getElementById('coordsDiv');
				map.controls[google.maps.ControlPosition.TOP_RIGHT].push(myControl);
				updateCoords();

				// -------- MAP EVENT HANDLING --------
				google.maps.event.addListener(map, 'click', function(event) {
					actualCrosshairPosition = event.latLng;
					if (actualCrosshairMarker == null) {
						addNewCrosshairMarker(map, actualCrosshairPosition);
					} else {
						actualCrosshairMarker.setPosition(actualCrosshairPosition);
						actualCrosshairMarker.set("labelContent", getPostionString(actualCrosshairPosition));
					}
					setNewCrosshairMarkerMenu();
				})

				google.maps.event.addListener(map, 'zoom_changed', function() {
					jQuery("#standardContext").hide();
					jQuery("#routeContext").hide();
					updateCoords();
					zoomChangeBoundsListener = google.maps.event.addListener(map, 'bounds_changed', function(event) {
						//here I have the correct zoom level
						setNewCrosshairMarkerMenu();
						google.maps.event.removeListener(zoomChangeBoundsListener);
					});

				});
				google.maps.event.addListener(map, 'center_changed', function() {
					jQuery("#standardContext").hide();
					jQuery("#routeContext").hide();
					updateCoords();
					zoomChangeBoundsListener = google.maps.event.addListener(map, 'bounds_changed', function(event) {
						//here I have the correct zoom level
						setNewCrosshairMarkerMenu();
						google.maps.event.removeListener(zoomChangeBoundsListener);
					});
				});

				// -------- MENU EVENT HANDLING OF CROSSHAIRMARKER --------
				// Set new standard marker
				$("#addStandardMarker").click(function() {
					var length = standardMarkerArray.length;
					standardMarkerArray[length] = addNewStandardMarker();					deleteCrosshairMarker();
				});

				// Set new route marker
				$("#addRouteMarker").click(function() {
					var length = routeMarkerArray.length;
					routeMarkerArray[length] = addNewRouteMarker();
					updateRoutePolylines();
					deleteCrosshairMarker();
				});

				// -------- MENU EVENT HANDLING OF STANDARD MARKER --------
				// Delete selected Standard marker
				$("#deleteStandardMarker").click(function() {
					for (var i = 0; i < standardMarkerArray.length; i++) {
						if (selectedMarker == standardMarkerArray[i]) {
							standardMarkerArray.splice(i, 1);
						}
					}
					jQuery("#standardContext").hide();
					selectedMarker.setMap(null);
					selectedMarker = null;				});

				// -------- MENU EVENT HANDLING OF ROUTE MARKER --------
				// delete selected Route Marker
				$("#deleteRouteMarker").click(function() {
					var length = routeMarkerArray.length;

					for (var i = 0; i < length; i++) {
						if (selectedMarker == routeMarkerArray[i]) {
							routeMarkerArray.splice(i, 1);
						}
					}

					updateRoutePolylines();
					jQuery("#routeContext").hide();
					selectedMarker.setMap(null);
					selectedMarker = null;
				});

				// delete Route completly
				$("#deleteRoute").click(function() {
					var length = routeMarkerArray.length;
					for (var i = 0; i < length; i++) {
						routeMarkerArray[i].setMap(null);
					}
					routeMarkerArray = new Array();
					route.setMap(null);
					route = null;
					updateRoutePolylines();
					jQuery("#routeContext").hide();
					selectedMarker.setMap(null);
					selectedMarker = null;
				});

				// computeDistanceBetween(from:LatLng, to:LatLng, radius?:number) <<<<<< FOR DISTANCE
			}
		</script>
	</head>
	<body onload="initialize()">
		<div id="coordsDiv" style="color: black; position: absolute; text-align: right; font-size: 1.4em; font-weight:bold; margin-right: 25px;">
			<span id="coordinations">0°00.00'N 0°00.00'E</span>
			<br />
			Lat <span id="lat">42</span> Long <span id="long">9</span> <br />
		</div>

		<!-- 	MENU FOR CROSSHAIR MARKER	 -->
		<div id="crosshairContext" style="z-index: 1000; position: absolute; display: none;">
			<ul id="crosshairMenu" class="menu">
				<li>
					<div>Position: <span id="crosshairPosition">Error</span></div>
				<li>
					<a id="addStandardMarker" href="#">Markierung setzen</a>
				</li>
				<li>
					<a id="addRouteMarker" href="#">Route setzen</a>
				</li>
				<li>
					<a id="addDistanceStart" href="#">Abstand von hier</a>
				</li>
				<li>
					<a id="addDestination" href="#">Zum Ziel machen</a>
				</li>
				<li>
					<a id="closecrosshairContext" href="#">Löschen</a>
				</li>
			</ul>
		</div>

		<!-- 	MENU FOR STANDARD MARKER	 -->
		<div id="standardContext" style="z-index: 1000; position: absolute; display: none;">
			<ul id="standardMenu" class="menu">
				<li>
					<div>Position: <span id="standardPosition">Error</span></div>
				<li>
				<li>
					<a id="deleteStandardMarker" href="#">Markierung Löschen</a>
				</li>
				<li>
					<a id="closestandardContext" href="#">Menü schließen</a>
				</li>
			</ul>
		</div>

		<!-- 	MENU FOR ROUTE MARKER	 -->
		<div id="routeContext" style="z-index: 1000; position: absolute; display: none;">
			<ul id="routeMenu" class="menu">
				<li>
					<div>Position: <span id="routePosition">Error</span></div>
				<li>
				<li>
					<div>Distanz vom Start: <span id="routeDistance">Error</span></div>
				<li>
				<li>
					<a id="deleteRouteMarker" href="#">Markierung Löschen</a>
				</li>
				<li>
					<a id="deleteRoute" href="#">Route Löschen</a>
				</li>
				<li>
					<a id="closerouteContext" href="#">Menü schließen</a>
				</li>
			</ul>
		</div>
		<div id="mapCanvas" style="width:100%; height:100%"></div>
	</body>
</html>